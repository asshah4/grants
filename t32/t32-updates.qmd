---
title: "Research-In-Progress"
author: "Anish Sanjay Shah, MD/MS<br><span style = 'font-size: 70%;'>Cardiology Fellow<br>University of Illinois at Chicago</span>"
format: 
  revealjs:
    theme: simple
    footer: "[Stress Epidemiology]{style='color:#1E87E5FF'}, [Arrhythmia Mechanisms]{style='color:#F8A725FF'}, [Clinical]{style='color:#C1185AFF'}, [Computational Neurocardiology]{style='color:#00887AFF'}"
    scrollable: true
execute:
  cache: false
---


```{r}
#| label: setup
#| include: false

# Libraries
library(tidyverse)
library(arcana)
library(volundr)
library(durandal)
library(coraline)
library(googledrive)
library(googlesheets4)
library(clock)
library(gt)
library(glue)
library(ggsci)
library(scales)

# Location
find_project_folder <- function() {
	x <- sessionInfo()$running
	if (grepl("mac", x)) {
		file.path("/Users", "asshah4", "projects")
	} else if (grepl("Windows", x)) {
		file.path("C:/Users", "asshah4", "projects")
	}
}

# Used in YAML above as well - lower is darker, higher is lighter
stress <- pal_material("blue", reverse = TRUE)(9)
arrhythmia <- pal_material("yellow", reverse = TRUE)(9)
clinical <- pal_material("pink", reverse = TRUE)(9)
computational <- pal_material("teal", reverse = TRUE)(9)
text <- pal_material("blue-grey", reverse = TRUE)(9)

# Google data
log <- 
	drive_get("research_log") |>
	read_sheet(sheet = "calendar_sheet") |>
	mutate(
		Start = date_start(Start, "minute"),
		End = date_end(End, "minute")
	) |>
	mutate(Duration = difftime(End, Start, units = "hours")) |>
	filter(str_detect(Calendar, "Clinical|Research|Academics|Administrative")) |>
	filter(Duration < 24) |>
	mutate(Type = gsub("Research/", "", gsub("/Service", "", gsub("/Extracurricular", "", Calendar)))) |>
	select(-c(Calendar, Description))

progress <-
	drive_get("research_log") |>
	read_sheet(sheet = "status_sheet")


tbl_status_updates <- function(progress, effort) {
	
	data <-
		left_join(progress, effort, by = "Type") |>
		group_by(Type) |>
		arrange(Effort, Priority) |>
		arrange(Priority) |>
		mutate(Type = paste0(Type, " (", Effort, ")")) |>
		mutate(Deadline = as.Date(Deadline)) |>
		select(-Effort) |>
		filter(Priority < 3) |>
		select(Type, Project, Task, Deadline, Priority) |>
		group_by(Project) |>
		mutate(num = 1:n()) 
		
	
	data |>
		gt(rowname_col = "Project", groupname_col = "Type") |>
		opt_table_lines(extent = "none") |>
		opt_row_striping(row_striping = FALSE) |>
		tab_options(data_row.padding = px(2)) |>
		# Headers and Row Groups
		tab_style(
			style =  cell_text(
				size = "large",
				weight = "bold",
				transform = "capitalize"
			),
			locations = cells_column_labels()
		) |>
		tab_style(
			style = cell_text(color = "white"),
			locations = cells_stub(rows = num != 1)
		) |>
		tab_style(
			style = list(cell_fill(color = stress[5]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = stress[5])),
			locations = cells_row_groups(groups = contains("Epidemiology"))
		) |>
		tab_style(
			style = list(cell_fill(color = arrhythmia[2]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = arrhythmia[2])),
			locations = cells_row_groups(groups = contains("Arrhythmia"))
		) |>
		tab_style(
			style = list(cell_fill(color = clinical[5]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = clinical[5])),
			locations = cells_row_groups(groups = contains("Clinical"))
		) |>
		tab_style(
			style = list(cell_fill(color = computational[3]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = computational[3])),
			locations = cells_row_groups(groups = contains("Computational"))
		) |>
		tab_style(
			style = list(cell_fill(color = text[3]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = text[3])),
			locations = cells_row_groups(groups = contains("Academic"))
		) |>
		# General formatting
		tab_style(
			style = cell_text(color = "white"),
			locations = cells_body(columns = Task,
														 rows = is.na(Task))
		) |>
		tab_style(
			style = cell_text(color = "white"),
			locations = cells_body(columns = Deadline,
														 rows = is.na(Deadline))
		) |>
		tab_style(
			style = cell_text(align = "center"),
			locations = list(cells_stub(), cells_column_labels())
		) |>
		tab_style(
			style = cell_borders(sides = "bottom", color = text[5]),
			locations = list(cells_body(columns = everything()), cells_stub(rows = everything()))
		)  |>
		# Columns
		cols_hide(columns = c(Priority, num)) |>
		fmt_date(columns = "Deadline", date_style = "iso") |>
		tab_style(
			style = cell_text(size = "x-small"),
			locations = cells_body(columns = "Deadline")
		) |>
		tab_style(
			style = cell_text(style = "italic"),
			locations = cells_stub()
		) |>
		cols_width(
			Project ~ pct(40),
			Task ~ pct(45),
			#Description ~ pct(35),
			Deadline ~ pct(15)
		) 
		
}
```


```{r}
#| label: product  page
#| echo: false
dt <- 
	date_build(year = 2022, month = 12, day = 12) |>
	add_days(-7)

effort <-
	log |>
	filter(Start >= dt) |>
	filter(Start > dt & End < add_days(dt, 7)) |>
	select(Type, Title, Duration) |>
	mutate(Total = as.numeric(sum(Duration))) |>
	mutate(Effort = as.numeric(Duration)/Total) |>
	group_by(Type) |>
	summarize(Effort = paste0(signif(100 * sum(Effort), 2), "%")) 

tbl_status_updates(progress, effort)
```

# December 12, 2022


## AF Catheter Ablation and Recurrence

Data/power increase:

- Inclusion of VA data
- Additional data pull from EPIC by Scott Uphouse (pending)
- Inclusion of UIC billing code data?

## Atrial Flutter and Family History

Pedigrees:

- How should these be incorporated into the manuscript? 

Genetics:

- 305 patients that have undergone whole exome sequencing, but unclear how to match these to the AFL data
- Should we genotype the rest of the EO-AFL patients?

## ECG/EGM analysis

```{r}
library(rhythm)
x <- read_lspro(file = file.path(find_project_folder(), "research", "t32", "sample-egm.txt"))

ggm(x, channels = c("I", "CS", "HIS M", "HIS D", "RV")) |>
	add_intervals(channel = "I")
```


## K23 Aims {.smaller}

Objective: _Clinical EP researcher using computational neurocardiology techniques to study arrhythmia mechanisms_

1. Vagal tone and triggered arrhythmias
- Manuscript on stress-induced vagolysis and CV mortality __under review__
- ANS dysfunction during/with ischemia __work-in-progress__
- [Create murine/translational model for vagolysis and triggered arrhythmias]{.arrhythmia[2]}

1. Arrhythmia phenotyping
- AFL/FH manuscript __work-in-progress__
- AF/race project __work-in-progress__
- [Classification of arrhythmia phenotypes using large data set (MVP/VA research data, UIC, ARIC)]{.computational[3]}

Mentorship Team: __Amit J. Shah__, __Dawood Darbar__, Rachel Lampert, Viola Vaccarino, Mark McCauley, Andrew Boyd, Alvaro Alonso

## Murine Model of Vagolysis {.smaller}

- Atria are heavily innervated by ANS ganglia
	- Sympathovagal balance locally mediated through adrenergic lysis of cholinergic activity 
	- Neuropeptide Y (NPY) causes cholinergic inhibition through Y2R 
- Pro-arrhythmic murine model (compared to healthy controls)
	- Ex-vivo vagal-sparing Langendorf preparation
	- Catecholamine infusion and NPY Y2R antagonists to modulate arrhythmic state
- Measure atrial conductive properties as outcome
	- Baseline, with catecholamine infusion, VNS stimulation, and Y2R antagonism

