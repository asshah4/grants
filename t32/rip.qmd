---
title: "Research-In-Progress"
author: "Anish Sanjay Shah, MD/MS<br><span style = 'font-size: 70%;'>Cardiology Fellow<br>University of Illinois at Chicago</span>"
format: 
  revealjs:
    footer: "[Epidemiology]{style='color:#1E87E5FF'}, [Arrhythmia ]{style='color:#F8A725FF'}, [Clinical]{style='color:#C1185AFF'}, [Computational ]{style='color:#00887AFF'}"
    scrollable: true
execute:
  cache: true
tbl-cap-location: bottom
fig-cap-location: bottom
---

```{r}
#| label: setup
#| include: false
#| cache: false

# Libraries
library(tidyverse)
library(vlndr)
library(shiva)
library(hrd)
library(googledrive)
library(googlesheets4)
library(clock)
library(gt)
library(glue)
library(ggsci)
library(scales)
library(vroom)

# Location
find_project_folder <- function() {
	x <- sessionInfo()$running
	if (grepl("mac", x)) {
		file.path("/Users", "asshah4", "projects")
	} else if (grepl("Windows", x)) {
		file.path("C:/Users", "asshah4", "projects")
	}
}


# Used in YAML above as well - lower is darker, higher is lighter
stress <- pal_material("blue", reverse = TRUE)(9)
arrhythmia <- pal_material("yellow", reverse = TRUE)(9)
clinical <- pal_material("pink", reverse = TRUE)(9)
computational <- pal_material("teal", reverse = TRUE)(9)
text <- pal_material("blue-grey", reverse = TRUE)(9)


tbl_status_updates <- function(progress, effort) {
	
	data <-
		left_join(progress, effort, by = "Type") |>
		group_by(Type) |>
		mutate(Type = paste0(Type, " (", Effort, ")")) |>
		mutate(Deadline = as.Date(Deadline)) |>
		select(-Effort) |>
		filter(Priority < 3) |>
		select(Type, Project, Task, Deadline, Priority, Status) |>
		group_by(Project) |>
		arrange(Project, Priority) |>
		mutate(num = 1:n()) 
		
	
	data |>
		gt(rowname_col = "Project", groupname_col = "Type") |>
		opt_table_lines(extent = "none") |>
		opt_row_striping(row_striping = FALSE) |>
		tab_options(data_row.padding = px(2)) |>
		# Headers and Row Groups
		tab_style(
			style =  cell_text(
				size = "large",
				weight = "bold",
				transform = "capitalize"
			),
			locations = cells_column_labels()
		) |>
		tab_style(
			style = cell_text(color = "white"),
			locations = cells_stub(rows = num != 1)
		) |>
		tab_style(
			style = list(cell_fill(color = stress[5]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = stress[5])),
			locations = cells_row_groups(groups = contains("Epidemiology"))
		) |>
		tab_style(
			style = list(cell_fill(color = arrhythmia[2]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = arrhythmia[2])),
			locations = cells_row_groups(groups = contains("Arrhythmia"))
		) |>
		tab_style(
			style = list(cell_fill(color = clinical[5]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = clinical[5])),
			locations = cells_row_groups(groups = contains("Clinical"))
		) |>
		tab_style(
			style = list(cell_fill(color = computational[3]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = computational[3])),
			locations = cells_row_groups(groups = contains("Computational"))
		) |>
		tab_style(
			style = list(cell_fill(color = text[3]),
									 cell_text(color = "white"),
									 cell_borders(sides = "all", color = text[3])),
			locations = cells_row_groups(groups = contains("Academic"))
		) |>
		# General formatting
		tab_style(
			style = cell_text(color = "white"),
			locations = cells_body(columns = Task,
														 rows = is.na(Task))
		) |>
		tab_style(
			style = cell_text(color = "white"),
			locations = cells_body(columns = Deadline,
														 rows = is.na(Deadline))
		) |>
		tab_style(
			style = cell_text(align = "center"),
			locations = list(cells_stub(), cells_column_labels())
		) |>
		tab_style(
			style = cell_borders(sides = "bottom", color = text[5]),
			locations = list(
				cells_body(columns = everything()),
				cells_stub(rows = everything())
			)
		) |> 
		tab_style(
			style = cell_text(color = "grey"),
			locations = cells_body(columns = Task,
														 rows = Status == "complete")
		) |>
		tab_style(
			style = cell_text(weight = "bold"),
			locations = cells_body(columns = Task,
														 rows = Status == "waiting")
		) |>
		tab_style(
			style = cell_text(style = "italic"),
			locations = cells_body(columns = Task,
														 rows = Status == "defer")
		) |>
		# Columns
		cols_hide(columns = c(Priority, num, Status)) |>
		fmt_date(columns = "Deadline", date_style = "iso") |>
		tab_style(
			style = cell_text(size = "x-small"),
			locations = cells_body(columns = "Deadline")
		) |>
		tab_style(
			style = cell_text(style = "italic"),
			locations = cells_stub()
		) |>
		cols_width(
			Project ~ pct(40),
			Task ~ pct(45),
			#Description ~ pct(35),
			Deadline ~ pct(15)
		) 
		
}
```


```{r}
#| label: tbl-progress
#| tbl-cap: Progress updates
#| echo: false
dt <- 
	date_build(year = 2023, month = 12, day = 3) |>
	add_days(-30)

progress <-
	drive_get("research_log") |>
	read_sheet(sheet = "progress_sheet") |>
	filter(Deadline >= dt)

effort <-
	drive_get("research_log") |>
	read_sheet(sheet = "calendar_sheet") |>
	mutate(
		Start = date_start(Start, "minute"),
		End = date_end(End, "minute")
	) |>
	mutate(Duration = difftime(End, Start, units = "hours")) |>
	filter(str_detect(Calendar, "Clinical|Research|Academics|Administrative")) |>
	filter(Duration < 24) |>
	mutate(Type = gsub("Research/", "", gsub("/Service", "", gsub("/Extracurricular", "", Calendar)))) |>
	select(-c(Calendar, Description)) |>
	filter(Start >= dt) |>
	filter(Start > dt & End < add_days(dt, 7)) |>
	select(Type, Title, Duration) |>
	mutate(Total = as.numeric(sum(Duration))) |>
	mutate(Effort = as.numeric(Duration)/Total) |>
	group_by(Type) |>
	summarize(Effort = paste0(signif(100 * sum(Effort), 2), "%")) 

tbl_status_updates(progress, effort)
```

# December 4, 2023

## HRS abstract proposals {.tiny}

- [TTN variant prediction]{.red}: Would like to submit abstract, currently training an ECG-based model to classify variants (pathogenic vs. controls). Training data of approximately 50-60k sinus beats, with 500-700 "pathogenic TTN cases". *Data augmented by breaking ECGs into individual beats*
- [AFL & Family History]{.red}: Abstract to be submitted, with equivalent co-authors as manuscript submission
- [TTN variants and EP outcomes]{.red}: Gursuk/James and others wanted to pursue EP-based outcomes. Have ~9 cases of PVI performed on TTN variants that are non-benign (e.g. VUS or LP/P). 

# November 20, 2023

## AFL/FH updates 

- [ ] Feedback? Should we request for an extension?
- [ ] Circulate amongst co-authors

*Why do we believe that Black v. Non-Black individuals had higher rates of AFL despite balanced risk factors?*

## AF Registry and CCTS Data

1. Have all EMR data from 2010 to 2023 now, which increased file sizes by 30% (now over 70 Gb), and increased `n = 140k` to `n = 210k`
1. Have all ECG for same patient population (approximately 40 Gb in XML format)
1. Created `parquet` format to utilize Apache Arrow for I/O

- [ ] Development of filtering pipeline for MRNs, diagnoses, medications, procedures, etc.

## AFEQT/SDOH {.smaller}

Which key variables should be included for evaluation? Some of these have been studied, but not in context of AFEQT/symptom burden

- ECG factors at baseline compared to at time of repeat evaluation (heart rate, rhythm)
- Maintenance of sinus rhythm (percent burden of AF, frequency of ECG in sinus rhythm)
- Medication changes or intensification (addition of anti-arrhythmic)
- Referral to cardioversion or ablation
- Administration of anticoagulation therapy

## ECG/TTN

Timeline for abstract submission to HRS (12/15):

- Complete initial model training on pathogenic TTN cases
- Exclude other TTN variants from analysis to have *cleaner* controls
- Identify appropriate metrics (e.g. AUC, net classification, etc)
- Identify if segments of ECG are more highly weighted (variance importance)

# November 13, 2023

## Updates {.smaller}

- [ ] AFL/FH paper revisions before resubmission (**deadline 12/05**), would like feedback in next 3-4 days, then *circulate to co-authors*
- [ ] Clean CCTS/AF Registry data over next 2 weeks, with anticipation of AFEQT being complete in that time-frame
- [ ] Submit rank list for EP fellowship on Wednesday 11/15
- [ ] Meetings with Emilia Benjamin and Seung H. Choi in next 2-3 weeks to discuss AF phenotyping project
- [ ] PRS calculations with SNPs from NW

# October 26, 2023 

## AFL/FH Simple Revisions {.smaller}

- Conform with AHA guidelines on reporting health differences by races
- Including __Clinical Perspective__ section
- More detailed methods on patient selection and recruitment
- Directionality when discussing associations (e.g. weight versus *increased weight*)
- Add definitions for social drinking
- Clarify anti-hypertensive agents and selection
- Clarify results and statistical methods to match discussion
- Requesting how and why we defined EOAFL as age < 65

## AFL/FH Complex Revisions {.tiny}

1. Concern is the definition of family history to include AF, HF, and CVA, as is __inconsistent__ with the idea of EOAFL as a separate entity. *Unsure how to respond*
1. Can occult AF be analyzed as a comparative group? *Unsure about an additional dataset. However would strengthen the paper if we had a matched cohort as sensitivity analysis.*
1. In those without stated FH, the FDR were not contacted - reviewers are concerned that frequently patients are unaware of FH, and recommended contacting every study participant.  *Two paths: 1) Ignore this and state we had a rigorous approach to FH questionnaires; 2) Pursue the ~300 patients with EOAFL and contact FDR to limit confounding.*
1. Provide a hypothesis and reasoning for the choice of variables. Particularly that of race. *Would refer to genetics and poor representation in other studies.*
1. Concern for why we emphasized difference between Black race and White/Latinx race. *Would compare Black to non-Black instead*
1. Hypothesis on inverse relationsihp between HTN/BB/CCB and EOAFL risk 

# October 23, 2023 

## Updates {.smaller}

AFEQT/SDOH: Current focus is on obtaining updated AFEQT, led by *JS*, with goal to complete AFEQT in next several weeks. In parallel, using EMR-based records to evaluate clinical outcomes. It will take roughly 30 hours of statistical work to incorporate the clinical and AFEQT data (roughly 1-2 weeks), once the AFEQTs are done.

AFL/FH: Our good news was that JAHA is willing to review our paper again with revisions. A majority of these will likely be completed within the next 4-5 days (deadline = 10/31) but have to decide on if new/additional FH data collection is needed. The most challenging critique was the potential bias in FH reporting during initial screening. To overcome this, the most thorough option would be to obtain FH data from every patient to avoid systemic errors/bias. However, a limited approach of verifying FH in just the EOAFL may be reasonable. Would like everyone's thoughts here.

Phenotype AF: Two students have joined this effort, *SS* and *SD*, who will be working on initially on the DSP and ML aspects. Current priority is to finish training the models using the TTN data. Unfortunately, this has been delayed with Boards and interviews, but hope to speed this back up in the next 1-2 weeks.

AF/PRS: For our evaluation of the PRS in AF in ethnic cohorts, we are meeting with the eMERGE group (NW). We will need to understand if the PRS can be validated in our UIC cohort, and if there is an existing mechanism to integrate a GIRA with our own EHR.

# September 18, 2023

## EMR Data

This has been somewhat streamlined to [extract data]{.green} from the CCTS data pull, with full cohort results returned from CCTS.

1. Need to extract AF registry patients and add SDOH, medication intensification, and procedure reports.
1. Working with Tofovic/Nischal to extract echocardiogram data
1. Extracted roughly 8k ECG, digitized, and segmented to individual beats, which provides roughly 40k samples for testing amongst the ~300 WES patients
1. Working with Chen to complete power calculations based on our population and current literature

## AFEQT/SDOH

- Spoke with Jerry/Muriel about re-organizing the AFEQT data for manuscript
- Will need to complete roughly `n=600` follow-up AFEQT
- Power calculation suggest would need `n=200` Hispanic/Latinx
- Timeline TBD (expect ~ 4-6 weeks)
- Subsequently will need to extract patient outcomes (intensification, burden) from CCTS pull
- Adding Angela Hussain to data collection as student researcher
- Check in with Annette to help with Spanish-speaking requirements

## AF/Genetics

Met with AFGen group (Patrick Elinor, Emilia Benjamin), encouraged computational approach in genetics. 
Currently working to filter and annotate our WES dataset, but expanding to novel gene regions (e.g. neurocardiac receptors) that are not included in general cardiomyopathy/arrhythmia panels.

1. Variant evaluation/assessment of different reference genomes
1. Variant filtering based on SIFT/PolyPhen
1. Annotation based on multiple sources (USCS, NCBI, etc)
1. Inclusion of broader, related genes (e.g. **ADRB2** not included in recent evaluation)

# September 11, 2023

## AFEQT {.smaller}

Current manuscript has `n=453` individuals split amongst races, with some strength of assocation b/w SES/SDOH and ∆AFEQT. 

- Have `n=760` baseline AFEQT data points, but need roughly `n=600` additional follow-up AFEQT scores
- Have `n=1506` currently in AF Registry, thus `743` more patients that can be added
- Would allow us to be powered for mediation analysis, and stratified analyses
- Able to incorporate [intensification]{.orange} and [recurrence]{.orange} rates now, as well as census tract (vs. zip) and language barriers now

---

[Next]{.underline}: 

1. Complete the additional `600` AFEQT follow-ups
2. Extract data from CCTS to "flush out" registry data
3. More specific/appropriate analyses for SDOH including [mediation]{.blue}

## PRS for AF/eMERGE

1. We are meeting with NW and the eMERGE group to validate PRS in AA/HL population here at UIC this week.
1. Met with Hua Yua Chen to go over PRS power calculations 
1. Generating multiple sample size/power calculations based on C-statistics seen in other AF/PRS papers &rarr; however may not apply equivalently in AA/HL population as primarily derived from Caucasian populations

# September 8, 2023

## AF/Genetics {.smaller}

Completed [computational genetics coursework]{.grey} on variant analysis. Although some work has already been done on this, going through the basics will allow us to have in-house [variant annotation pipeline]{.green}

1. Uploaded our ~2G of patients to cluster 
1. Generated functions to [split VCF]{.green} by individual case 
1. Identified variant locations 

[Next]{.underline}: Evaluate variants using **PolyPhen** and **SIFT** databases

## ECG/pAF {.smaller}

Recently was asked to review/adjudicate ECG for the PhysioNet challenge on AF prediction algorithms. In line with my interest at phenotying AF based on ECG markers. 

1. Segmentation of individual beats has been automated 
1. Augmenting the data to individual beats (similar to @vandeLeur2021)

[Next]{.underline}: Training on labeled [AF patients with TTN variants]{.orange}

---

![Annotation of individual beats](../figures/shiva-ecg-annotated.png){#fig-annotated-ecg}

## AF/SDOH

- eMERGE network meeting this week
- Processing UIC/CCTS data 
- Uploaded January to June ECG data from MUSE
- Will still need updates from CCTS for 2023 remaining clinical data
- Have to solidify definitions for [therapy intensification]{.red} and [AF outcomes]{.red}

# August 21, 2023

## Phenotyping AF {.smaller}

*Identifying phenotypes of AF that are at risk of progression (e.g. developing higher burden, persistent AF, TICM, etc)*

1. Extracted clinical covariates for ~6k patients, stratified by time/onset (this is ~7 million diagnoses)
1. Extracted medications by time/duration of prescription
	a. Filtered down to all cardiovascular medications
	a. Classified medications that are relevant to AF (AC/AP, AAD)
	a. 2.5 million prescriptions were analyzed
1. Evaluated ECG related to this population and initiated segmentation/feature extraction
1. **Goals**: Pull procedure reports to assess burden, and process text-based echocardiography data

## ECG and Genetic Variants {.smaller}

1. Completed the software needed to annotate ECGs on single leads
1. Will have to evaluate efficacy amongst 12-lead systems (e.g. 5000 x 12 array)
1. Using [semantic segmentation]{.green} approach to classify waveforms
1. Have started [cluster-based]{.green} pipeline development for re-calling VCF to identify variants based on...
	a. Multiple different population panels (different allele frequencies)
	a. Filter on read depth and quality
	a. *Will need to learn about other filtering approaches*
	
## SDOH/AF/HSR {.smaller}

- Current knowledge gap is interaction between race/ethnicity and socioeconomic status in management of AF [@Essien2021]
- Similar to AF Registry + Cluster, can use the definition of **treatment intensification** as part of health care differences
- Parent project to AF/language 
- Unlike other cohorts (e.g. ARIC had `n=3200` but only `n=500` were Black), have more diverse population pool

# August 14, 2023

## AFL/FH {.smaller}

Completed revisions to paper with tentative plans for re-submission.

1. Called `n=31` families to confirm AFL/AF diagnoses and clarify CHF and CVA histories
1. Re-analyzed pedigrees with multiple definitions of +FH in FDRs as a *sensitivity analysis*
1. Major findings remain same (and **robust** to adjustment):
	- +FH doubles risk for "premature" or earlier onset of AFL
	- EOAFL as corrolary increases likelihood of AF and AFL in FDRs
	- Black race a/w EOAFL, partially mediated through OSA/ETOH (most prominent in this subgroup)
1. Resubmission to... **JAHA**, **AHJ**, **IJC**, **BMJ Heart**

## AF/SDOH {.smaller}

- `n=4537` patients (still missing updated CCTS pull of about 2k)
- 92% have NDI via census tract
- 52% have social histories completed
- 81% are English speaking, 10% Spanish
- Medications/Labs/Vitals/Visits/Comorbidities being evaluated currently

## AF Phenotyping {.smaller}

![P wave detection](../figures/saclova-2022-p-wave-detection.png){#fig-pwave-detection}

Working on ECG beat segmentation and annotation using machine learning approach across multiple leads. Will be applicable across ECG-based projects. Necessary step prior to creating median beats.

# July 31, 2023

## AFL/FH Reviewer Concerns {.smaller}

1. How many FDR were directly contacted?
1. What constitutes an "atrial arrhythmia" in family members? Often asymptomatic. Needs clear definition
1. Why LOAFL versus EOAFL, instead of EOAFL versus controls?
1. Why is FH/Race significant only in a single racial group?
1. Overstatement of importance of FH over *4q25* papers in isolated AFL
1. How are CVA events labeled as cardioembolic?
1. Why include CHF as part of arrhythmia risk factors in FDR?
1. Define excess ETOH usage
1. Pedigree needs to be labeled more specifically/informatively

# July 24, 2023

## Active projects

1. AFL/FH: Revisions to be addressed in next draft. Will identify additional journals to target.
1. HRV/CVD: EHJ 
1. ECG/PAF: Active project involving computational approach at identifying sub-phenotypes of paroxysmal AF based on ECG-driven parameters *with subsequent work on clinical patterns and trajectory*

## Phenotyping AF

Project is a "big data" project using over clinical data from 2010 to 2023, supplementing the AF Registry with *data mining* and *machine learning* approaches.

Composed of three elements:

1. ECG data in form 12-leads of 10 second signals, sampled at 500 Hz from 2010 to now
1. Clinical structured documentation including vitals, medications, labs, echo/study reports from 2010 to now
1. Clinical unstructured data from MD documentation

## Data overview 

ECG data: 

- 500k ECGs collected from 2010 to 2013
- 70 Gb of raw XML data (converts to ~50 Gb of WFDB)

Raw clinical data: 

- 43 Gb raw data (70% is from clinical notes alone)
- 145k unique patients with CVD diagnoses (cardiomyopathy, arrhythmia, vascular dz, etc)

## AF-specific data

ECG data:

- 33k ECG with a diagnosis of an atrial arrhythmia
- 6k unique patients with a diagnosis of AF confirmed by ECG
- Of those 6k patients, 95k ECG taken in total (both sinus + AF)

Clinical data:

- Of the 6k patients c- AF on ECG, 3.9k have clinical data available from CCTS
- Aggregate file size for this 3.9k is < 1 Gb in total
- 600k ICD diagnoses, 4.5 million lab results, 500k visits, 1.5 million vital sign measurements, 2.9 million medications

## Project status

Currently have working pipeline for extracting relevant diagnoses, medications, labs, etc, for additional projects. Can email ashah282@uic.edu for questions or project proposals.

Can see current proposal [here](https://asshah4.github.io/research/t32/phenotype-af.html)

# June 12, 2023

## Backbone for aims {.smaller}

1. Sympathetically-mediated AF occurs predominantly earlier in paroxysmal AF, in hearts with minimal scar burden. 
1. To cause episodes of AF would require abnormalities in conduction from both intracardiac and extracardiac causes
1. Abnormalities from both intracardiac and extracardiac causes are either acquired or genetic
1. These factors may also lead to different rates of progression of AF

[Question]{.underline}: Do certain genetic variants contribute to the progression of paroxysmal AF to persistent AF? 

## Trajectory of pAF {.smaller}

- @Kerr2005 from a Canadian Registry followed `n = 757` for ~8 years, 5 year recurrence was >60%
	- Positive predictors = age, +AS, +MR, LAE, reduced LVEF
	- Negative predictor = rapid heart rate during AF 
- Post catheter ablation, 5 years recurrence was 60% (1st ablation), and 20% after (>2 ablations) (@Takigawa2014)
	- Predictors = LAVI and patient age
- @Holmqvist2015 noted progression based on age + increased heart rate in sinus (CHA2DS2VASc had minimal discriminatory power)
- @Andrade2023 evaluated 3 year follow in ablation versus AAD, found `HR = 0.51`
- *Acutely, post-cardiac surgery AF can be predicted by decreased HRV (@Vesela2023)*
	
## Predictors of pAF progression {.smaller}

**CUrrently progression is poorly defined...**

- Clinical: need for rhythm control intervention (ECV, PVI), hospitalization for symptoms or heart failure, % burden increase by an inflection point 
- ECG: Decrease HF-HRV, increased P wave duration/dispersion, decreased P wave amplitude (during AF, decreased F-wave amplitude)

**Persistent** = `n` continous ECG in AF, diagnosis by cardiology, >7 day duration of episodes (or less)

::: aside
How should we define progression, rate of progression, and persistence?
:::

## Approach for evaluation

1. Establish clinical progression of disease with multiple *versions* of the definition
1. Obtain ECG data (segmentation to evaluate sinus beats)
1. Assess genetic variants &harr; ECG characteristics to compare with outcomes

---

![Manhattan plot @Verweij2020](../figures/verweij-2020-manhattan.png){#fig-ecg-genetic-manhattan}

---

![Cluster of genetic variants by ECG component @Verweij2020](../figures/verweij-2020-clusters.png){#fig-ecg-genetic-clusters}

---

![Individual variants with ECG components @Verweij2020](../figures/verweij-2020-ecg-and-variants.png){#fig-ecg-variants-and-components}

## Next steps

- [ ] Obtain ECG data (currently have from 2010 to 2017)
- [ ] Segmentation approach for sinus beats
- [ ] F-wave identification for AF beats
- [x] Contact Broad Institute about SNP-array data from previous GWAS
- [ ] NLP approach to assessing paroxysmal versus persistent

# June 5, 2023

## Aims Progress {.smaller}

Goal: **Identify characteristics that define sympathetically-mediated paroxysmal AF (as compared to scar-mediated pAF) in trajectory of paroxysmal &rarr; persistent**

- Pending mentorship meeting (dates requested for Alvaro, Amit, Dawood)
- Met with Lampert - be much more specific in ANS factors in pAF
	a. Evaluate ECG during AF: coarse AF v. fine AF &rarr; triggering event (ADHF, surgery, etc...)
	a. Evaluate ECG during sinus: P wave morphology/area/dispersion and AF burden
	a. *Evaluate candidate genes (ANS neurohormonal pathways) in Emory Cohort (which has high vagolysis burden) as initial study; validate these genes in AF registry with burden/rate of AF progression*

## AF Phenotyping

- Pending CCTS to upload data (hundreds of GB in size)
- Complete setting up cluster computational pipeline for NLP of unstructured text
- Specific goal is to identify timepoints: onset of AF, transition to persistent AF
- Initiate analysis of ECG data
	1. Convert to annotation format (WFDB)
	1. Identify median P waves per ECG

# May 22, 2023

## ECG analysis {.smaller}

__K23 AIM #1__ is to identify paroxysmal AF into low-scar burden (and high vagolytic triggers) in AF registry.

- [x] Have imported _superset_ of ECGs from MUSE (~500k ECGs) in XML/binary format (including raw signal, diagnoses, timing, etc), approximately ~1 TB
- [x] Convert XML format into digital signal... software developed (same as for _HRX_ abstract), approximately ~250 GB
- [ ] Analysis of ECG markers: high frequency HRV, P wave dispersion, P wave terminal forces, and GEH (Wilson's vector gradient), and if possible to identify "coarseness" of AF
- [ ] Split data into PRE/POST AF diagnosis, and identify control group from other ECGs in superset

::: aside
For EGM and ECG, working with Bhaumik to identify morphology of signals in machine learning project
:::

# May 12, 2023

## Updates {.smaller}

:::: {.columns} 
::: {.column width="50%"}
1. ECG data is being pulled from MUSE in XML format
2. CCTS data pull to be completed today
3. EGM signal processing - work in progress with goal of automated beat generation of multi-channel leads (R/C++ package)
:::
::: {.column width="50%"}
- [ ] Need storage space for ECG data (raw and processed), cluster allows only 50Gb for read/write storage (batch processing): >100k ECG
- [ ] CCTS data will need raw storage space: 10 years of patient charts + notes
:::
::::

# May 8, 2023

## Goals

:::: {.columns} 
::: {.column width="50%"}
1. Phenotyping of AF, as current grouping is inadequate. Focus on risk category changing from paroxysmal to persistent (baseline concept of multi-wavelet reentry)
1. ECG- and EGM-based analysis of AF as additive components
1. CARTO/Rhythmia/EnSite cardiac mapping software to determine LA scar burden 
:::
::: {.column width="50%"}
- [x] NLP coursework, cluster set-up preparation
- [x] HRX abstract preparation on EGM and [Physionet/WFDB](https://physionet.org/content/wfdb/10.7.0/)
- [ ] Identify next paper to start preparing
- [ ] eMERGE/AF IRB _waiting on approval from eMERGE_
- [ ] EPS study IRB _in progress_
:::
::::

## HRx abstract

![Automated EGM annotation of single lead, with high-fidelity signal resolution. 75% file size reduction and 500% read/write speed-up.](../figures/shiva-avnrt-egm.png){#fig-his-bundle-potentials}

# April 17, 2023 

## Goals {.smaller}

:::: {.columns} 
::: {.column width="50%"}
1. Phenotyping of AF, as current grouping is inadequate. Focus on risk category changing from paroxysmal to persistent
1. ECG- and EGM-based analysis of AF as additive components
1. CARTO/Rhythmia/EnSite cardiac mapping software to determine LA scar burden 
:::
::: {.column width="50%"}
- [x] AFL/FH manuscript submission
- [x] HRV/CVD manuscript revisions
- [ ] Identify next paper to start preparing
- [ ] eMERGE/AF IRB
- [ ] EPS study IRB
- [ ] NLP coursework, cluster set-up preparation
- [ ] HRX abstract preparation on EGM and [Physionet/WFDB](https://physionet.org/content/wfdb/10.7.0/)
:::
::::

# April 10, 2023

## AF Ontology {.smaller}

Generation of key features that are related to arrhythmias:

1. Clinical history and trajectory
1. Echocardiographic findings
1. ECG-based features
1. Family and social history
1. Potential genetic markers

---

![Example from HF evaluation and progression](../figures/nagamine-2022-patient-timeline.png){#fig-feature-extraction}

---

![Utilizing patient features to create a matrix-based cluster](../figures/nagamine-2022-feature-generation.png){#fig-feature-gen}

---

![Support-vector based clustering, multidimensional K-clustering in feature-space](../figures/nagamine-2022-heart-failure-clusters.png){#fig-adhf-cluster}

## Phenotype-based WES cohort {.smaller}

:::: {.columns}
::: {.column width="60%"}
| Age | Comorbidities | Proportion |
| - | --- | - |
| - | none | 10-15% |
| &le; 55 | * | 20% |
| &le; 65 | &le; 1 | 20% |
| &le; 65 | &le; 2 | 10% |
| &le; 65 | &le; 3 | 10% |
| &ge; 65 | &le; 1 | 10-15% |
:::
::: {.column width="40%"}
Alternatively can aim for two major groups within paroxysmal cohort definition:

1. &le; 65y + structural heart disease (70%)
1. &le; 65y - structural heart disease (30%)

_Aim for 20-30% to have had PVI to be able to integrate intracardiac findings_.
:::
::::

---

![Autonomic inflexibility and CV mortality in HF and LF bands](../figures/tbl-hrv-groups-cvd.png){#tbl-hrv-grps-cvd}

---

![Improved model concordance with addition of autonomic inflexiblity](../figures/tbl-hrv-concordance.png){#tbl-hrv-concordance}

# March 31, 2023

## AF Phenotyping

NLP combined with DSP can help in identifying sub-phenotypes of AF...

1. Polygenic risk score assessment based on phenotypes and sub-phenotypes
1. Current phenotype approaches limited to structured text 
1. Unstructured data can be extracted from clinical notes using NLP tools: BERT, Sci/RoBERTa, meta mapper, etc

[AWS HPC + CCTS data + AF registry + EP lab + biomarkers]{.green}

---

![Complexity of phenotyping is based on how structured or unstructured the data may be](../figures/emerge-example-creating-phenotypes.png){#fig-emerge-example}

---

![Identifying a true phenotype is complex and most often incorrect unless corroborated through other mechanisms](../figures/emerge-venn-diagram-true-cases.png){#fig-emerge-true-cases}

---

![Phenotypke KB current standard for diagnoses of AF](../figures/phenotype-kb-afib.png){#fig-phenotype-kb-afib}

## EPS signal processing

Utilize combination of surface ECG and intracardiac EGM to...

1. Identify intracardiac features, e.g. multichannel morphologies
1. Evaluate atrial abnormalities, such as conduction left &rarr; right activation 
1. Feed features into LSTM or convolutional neural network to understand different AF phenotypes

---

![Annotated ECG to identify P wave, QRS, and T wave fiducial points](../figures/shiva-annotated-ecg-green.png){#fig-shiva-ecg}

- Summation of P wave force vectors across surface ECG (signal-averaged)
- Identify terminal P wave force abnormalities
- Evaluate changes in P wave morphology over time

# March 20, 2023

## Updates {.smaller}

- AFL/FH:
	- manuscript was sent for initial revisions (03/03/23)
	- feedback received on 03/17/23 from _Jordan_
	- second draft to be returned on 3/20/23
- [Aim 1]{.green}: "Big data" approach using claims-based data, IRB/CCTS approval obtained
	1. NLP/ML area of focus will be initially on AF (only performed x 1)
	1. Approach for recurrent events, Weibull distribution expected
- [HRV/CVD]{.blue} : 
	- priority for this week
	- HF/LF HRV values showing >10 fold HR for bottom versus top quartile (with almost >95% sensitivity)
- Genetic analysis:
	- ACER will start AWS workspace this week
	
## Help Wanted {.smaller}

- Ablation database: working with Wissner to revise ablation database
	- manual data reconciliation
	- OCR/OMR-based PDF conversion approach
	- ablation outcomes x genetics
- AF phenotyping: key part of [Aim 1]{.green}
	- Computational Biorepository for Cardiovascular Disease: CCTS data pull active, all clinical notes, data points, etc since 2010 on CVD
	- AF ontology needed using a NLP/LLM (e.g. BERT)
- NLP/ML for EHR data:
	- CBCD: overlap of DCM/AF registries, CCTS data pull of all clinical notes since 2010 on CVD
	- Key part of __Aim 1__ is to identify AF phenotypes in those with paroxysmal AF
	- AF Ontology: working with Andrew Boyd on AF-NLP framework (SciB)

# February 27, 2023

## Updates

- AFL/FH: will need age of diagnosis of event of family history prior to final analyses
- CAR: analysis pending by Konda, however unclear if we can strongly accept null-hypothesis

## Non-linearity in ANS dysfunction {.smaller}

1. Proportional hazard assumptions
	a. Defined using time-variance, time-interaction, Martingale residuals
	a. Satisfied PH assumptions
1. Non-linearity of HRV and CV mortality
	a. Spline analysis with up to 5 knots
	a. Parametric threshold analysis (survival modeling)
	a. Non-parametric (binary outcome) threshold analysis
	a. Identified __non-linearity__ of response
1. Re-analyzed data using cut-point (as shown in @fig-hf-hrv-reactivity-quartiles)
	a. Almost 100% accuracy in classifier of low-risk cohort
	a. Almost 10-fold hazard in identify high-risk cohort

---

![Increase of ~10 fold in CV mortality in 1/4 patients identified by abnormal resting and reactive vagal tone. Robust classifier of resilience.](../figures/hf-hrv-reactivity-km-quartile-curves.png){#fig-hf-hrv-reactivity-quartiles}

## Genetic analysis {.smaller}

1. WES-generated VCF files on n=28 patients from EO-AFL + FH subgroup
1. Due to size limitations (**no access to HPC**) converted VCF data ...
	a. VCF to Apache Arrow
	a. Arrow conversion to `feather` and to `parquet` for header, annotation, and columnar genotype data
	a. Analyze as in-memory array
	a. Re-vert to ASCII-based format for GZip formated VCF
1. Filtering of data
	a. Limited to coding regions
	a. Filtered for read depth > 20
	a. Compared to dbSNP builds using `SIFT` and `PolyPhen` 
	a. __Pending further annotations based on arrhythmia-panels__

## Specific aims

Have revised [aims](http://asshah4.github.io/research/k23/overview.html), and have drafted the x1 page __specific aims__ to be shared with mentors.

Mentors: D Darbar, AJ Shah, A Alonso, M McCauley, _A Boyd_

# February 20, 2023

## AFL/FH

- Genetic basis for FH may be more promising than association with FH broadly, but would require additional WES to be sent
- Would need to repeat VCF analysis for an arrhythmia panel (instead of cardiomyopathy panel)

## CBCD {.smaller}

Computational biorepository for cardiovascular disease

- Will need a large computational biorepository
	- Claims data from both CPT/ICD codes
	- Clinical documentation (raw text from clinical notes)
	- Medication history
	- Study data e.g. XML of ECG, echo reports, coronary angiograms, device interrogations, etc
- CCTS to pull data, DRA to be submitted today
	
::: aside
Also working on VA research database access, CART-CL reporting data, MVP, ARIC, and UK Biobank as additional large-scale data
:::

# February 6, 2023

## Updates

- AFL/FH: __WES__ needed prior to completing revisions
- ARIC: potential option to pursue genetic profiling in ARIC per Alvaro, need formal proposal
- K23: drafting specific aims in 1-pager format
- VCF: data able to be analyzed/cleaned, however requires more CPU to perform

::: aside
Currently on inpatient service with limited time
:::

---

![Chromosome 1 summary](../figures/vcf-sample-chr-1-from-mike.png){#fig-vcfr-summary}

# January 9, 2023

## Updates

:::: {.columns}
::: {.column width="50%"}
AFL/FH:

- Pedigrees/genetics completed (thanks to [Ana]{.blue}, [Shashank]{.blue}, [Mike]{.blue})
- Outline/draft to be re-written
:::
::: {.column width="50%"}
1. [HRV/CV Mortality]{.blue} paper rejected, need to re-think strategy with senior authors
1. K23 aims to include 1) EP lab as [translational]{.orange} component, 2) [arrhythmia risk prediction]{.blue} as [computational]{.green} component
:::
::::

## [AFL/genetics]{.blue}

- ~87 individuals with +FH
- ~81 individuals with WES
- ~18 individuals with VUS in total
- **1 individual** with VUS + FH

## Multiple Pedigrees

![AFL/surrogate disease burden](../figures/multiple_pedigree_plot.png)
## TTN Mutant

![AFL/mutant](../figures/pedigree_uic0530.png)
# December 19, 2022

## Updates

:::: {.columns}
::: {.column width="50%"}
AFL/FH:

- Pedigrees TBD
- Draft completed, pending feedback
- Supplemental tables needed?
:::
::: {.column width="50%"}
AF/Recurrence:

- Scott added additional patients from UIC (September 2020 to now)
- Data collection pending
:::
::::

## K23 Aims {.smaller}

Objective: _Clinical EP researcher using computational neurocardiology techniques to study arrhythmia mechanisms_

1. Evaluating vagolysis and its effect on triggered arrhythmia mechanisms, both ventricular (e.g. SCD) and atrial (triggered AF)
1. Using computational approach to phenotype triggered onset arrhythmias, e.g. atrial fibrillation

Mentorship Team: __Amit J. Shah__, __Dawood Darbar__, Rachel Lampert, Viola Vaccarino, Mark McCauley, Andrew Boyd, Alvaro Alonso

## K23 Approach

__Vagal tone and triggered arrhythmias__

- Manuscript on stress-induced vagolysis and CV mortality __under review__
- ANS dysfunction during/with ischemia __work-in-progress__
- [Create murine/translational model for vagolysis and triggered arrhythmias]{.arrhythmia[2]}

__Arrhythmia phenotyping__

- AFL/FH manuscript __work-in-progress__
- AF/race project __work-in-progress__
- [Classification of arrhythmia phenotypes using large data set (MVP/VA research data, UIC, ARIC)]{.computational[3]}

## Murine Model of Vagolysis {.smaller}

- Atria are heavily innervated by ANS ganglia
	- Sympathovagal balance locally mediated through adrenergic lysis of cholinergic activity 
	- Neuropeptide Y (NPY) causes cholinergic inhibition through Y2R 
- Pro-arrhythmic murine model (compared to healthy controls)
	- Ex-vivo vagal-sparing Langendorf preparation
	- Catecholamine infusion and NPY Y2R antagonists to modulate arrhythmic state
- Measure atrial conductive properties as outcome
	- Baseline, with catecholamine infusion, VNS stimulation, and Y2R antagonism

# December 12, 2022

## AF Catheter Ablation and Recurrence

Data/power increase:

- Inclusion of VA data
- Additional data pull from EPIC by Scott Uphouse (pending)
- Inclusion of UIC billing code data?

## Atrial Flutter and Family History

:::: {.columns}

::: {.column width="50%"}
Pedigrees:

- How should these be incorporated into the manuscript? 
:::

::: {.column width="50%"}
Genetics:

- 305 patients that have undergone whole exome sequencing, but unclear how to match these to the AFL data
- Should we genotype the rest of the EO-AFL patients?
:::

::::

## ECG/EGM analysis

```{r}
library(shiva)
x <- read_lspro(file = file.path(find_project_folder(), "research", "t32", "sample-egm.txt"))

ggm(x, channels = c("I", "CS", "HIS M", "HIS D", "RV")) 
```


# November 21, 2022

## Updates

- AHA IPA: Completed draft, pending revisions
- AFL Paper: Draft to be done by Wednesday
- AF Ablation + Biorepository: Pending IRB
- Stress and CVD Mortality: Submitted to _Circulation_, revisions Pending

# November 14, 2022  

## Early Onset Atrial Flutter  

1. Draft of paper expanded to include results 
1. Prominent findings of family history and association with arrhythmia 
1. Key tables and figures established  

Next steps:

- Find agreement in key results and figures
- Identify main finding
- Complete discussion section

# October 10, 2022

---

__AF Registry__

Status:

- Current [overview](https://github.com/asshah4/aflubber/R/af_ablation_recurrence.html)
- Not yet powered
- Will need to revise out approach

# October 2, 2022

---

__AF Registry__

- Current number: 219
- Recurrence rate: 46%
- Death = 12 
- MACE = 70 (including repeats)

---

```{r}
#| eval: false
#| echo: false
#| cache: true
store <- file.path(find_project_folder(), "mims", "_targets")
curves <- targets::tar_read(curves, store = store)
curves$lf_stress
```

--- 

```{r}
x <- cardiac_atlas$right_atrium_rao

ggplot() +
	theme_void() +
	geom_sf(data = x$chambers, aes(fill = structure)) +
	geom_sf(data = x$projections, aes(fill = structure)) + 
	geom_sf(data = x$valves, aes(fill = structure)) + 
	geom_sf(data = x$septum, aes(fill = structure)) + 
	geom_sf(data = x$vessels, fill = "white") +
	scale_fill_brewer(palette = "YlGnBu") +
	theme(legend.position = "none") 
```

GIS-based MAP of right atrium for mapping and localization purposes for publications.


# September 26, 2022

---


## AF Registry {.smaller}

:::: {.columns}

::: {.column width="40%"}
__Analysis__

- Genetic analysis in PLINK complete
- Models are set up for analysis once data intake is done
:::

::: {.column width="40%"}
__Status__

1. Have n = 238 currently
1. Reviewed 95 charts thus far (CAR team)
1. Of n = 108, 75 have had recurrence, 33 without (rate of about 70% of anyarrhythmia)
1. Of ECG based confirmation, 43 AF recurrence events (53%)

:::

::::

# September 12, 2022

---

## AF Registry {.smaller}

REDCap data dictionary is finalized. Next steps are:

1. Data entry for outcomes
2. Finalization of new patients to add from AF ablation registry

## Genetics {.smaller}

Currently able to:

- Format large SNP data sets into appropriate tables
- Utilize `PLINK` and `MERLIN` to process Chen's genetics data
- Run from R to help analyze findings

Next steps:

- Confirm ancestry (for practice) percent likelihood 
- Then, once outcome data is complete, analyze differences by race

Analytical methods:

- Time to binary outcome of recurrence
- Recurrent event analysis for AF recurrence
- Can revise with Bayesian modeling in `STAN` as well


# August 22, 2022

---

## AF Registry {.smaller}

:::: {.columns}

::: {.column width="40%"}
__Status__

- REDCap is in progress
- Have an additional list of registry patients that may/may not have had ablation

:::

::: {.column width="40%"}
__Next Steps__

1. Complete 100 REDCap patients
1. Identify 300 patients that have potentially had ablation

:::

::::

---

## CARTO Maps {.smaller}

- Ablation quantification
- Activation mapping
- EGM annotation
- Voltage mapping
- Conduction velocity
- Earliest/latest activation
- Geometry data



# August 15, 2022

--- 

:::: {.columns}
::: {.column width="40%"}
__UIC-wide data summary__

- N ~ XXX had ablation
- Date range from >= 2010

__AF registry data__

- N=~300 had ablation
- Date range from >= 2010

:::
::: {.column width="40%"}
__Next Steps__

1. Generate list of MRN for data collection
1. Use new REDCap to obtain ECG/ablation data
1. Run preliminary analysis on first 100 patients
1. Consider expansion to JBVA/ACMC data
:::
::::

# August 1, 2022

## AF Registry

Consider additional variables:

- Recurrent events and adjudication (HF, cardiac admission, MACE)
- Holter/ECG data and repeat collection (P-wave morphology, Wilson's vector gradient, amplitude of AF waves "coarseness")

Will check with the MESA and ARIC data base on how repeat events were defined.

## Murine EP Studies

```{r, out.width = "60%"}
knitr::include_graphics("../figures/electromap.png")
```

## Human EP Studies

```{r}
knitr::include_graphics("../figures/openep-ablation.png")
```

# July 25, 2022

## Forest Plots

::::{.columns}

:::{.column width="50%"}
```{r}
#| echo: true
#| eval: false
# Forest Plots
library(vlndr)
m <- rx(
	Petal.Length ~ X(Sepal.Length) + Petal.Width + S(Species),
	label = list(
		Petal.Length ~ "Length of Petals", 
		Species ~ "Genus of the Flower"
	),
	pattern = "direct"
	) |>
	fmls(order = 2) |>
	fit(.fit = lm,
			data = iris,
			archetype = TRUE) |>
	mdls()
```
:::

:::{.column width="50%"}
```{r}
#| echo: true
#| eval: false
tbl <- tbl_forest( #<<
	object = m,
	formula = Petal.Length ~ Sepal.Length,
	vars = "Species",
	columns = list(
		beta ~ "Estimate",
		conf ~ "95% Confidence Interval",
		n ~ "Number of Samples"
	),
	axis = list(
		lim ~ c(0, 3),
		breaks ~ c(0, 1, 2),
		lab ~ "ß (95% CI)",
		title ~ "Petal Length by Sepal Length"
	)
)
```
:::

::::

A simple way to make sub-group analysis Forest plots, working on improving customization.

---

```{r}
#| label: Example forest plot
#| echo: false
#| eval: false
tbl |>
	tab_style(style = cell_fill(color = "white"),
						locations = cells_body(columns = everything()))
```

# July 18, 2022

## AF Registry

The AF registry is described [here](https://asshah4.github.io/aflubber). Current issues:

1. Data quality - consistency between reviewers
1. Missingness - decisions on acceptable thresholds
1. Variable selection - echo findings, EP studies, medications, labs, symptoms
1. Management - REDCap, shared excel sheet
1. Adjudication/review - outcomes, clinical follow-up length
